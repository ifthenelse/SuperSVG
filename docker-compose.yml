services:
  supersvg:
    build:
      context: .
      dockerfile: Dockerfile.mamba
    # Force AMD64 for cloud compatibility (works on M3 Mac via Rosetta but slower)
    # For cloud deployment: RunPod, Lambda Labs, AWS EC2, etc.
    platform: linux/amd64
    image: supersvg:latest
    container_name: supersvg-training
    volumes:
      # Mount your dataset directory (REQUIRED - update the path below)
      - ${DATA_PATH:-./input}:/data
      
      # Mount output directories to persist training results
      - ./output_coarse:/workspace/output_coarse
      - ./logs:/workspace/logs
      - ./checkpoints:/workspace/checkpoints
    
    environment:
      # Set CUDA device (set to empty string for CPU-only)
      - CUDA_VISIBLE_DEVICES=0
      
      # Optional: set additional environment variables
      - PYTHONPATH=/workspace
    
    # Interactive mode by default - override with docker-compose run
    stdin_open: true
    tty: true
    entrypoint: ["/bin/bash"]
    
    # Uncomment for GPU support (requires nvidia-docker)
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
