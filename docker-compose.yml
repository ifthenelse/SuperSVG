version: '3.8'

services:
  supersvg:
    build:
      context: .
      dockerfile: Dockerfile.mamba
    image: supersvg:latest
    container_name: supersvg-training
    volumes:
      # Mount your dataset directory (update the path on the left side)
      - /path/to/your/dataset:/data
      
      # Mount output directories to persist training results
      - ./output_coarse:/workspace/output_coarse
      - ./logs:/workspace/logs
      - ./checkpoints:/workspace/checkpoints
      
      # Optional: mount the entire project for development
      # - .:/workspace
    
    environment:
      # Set CUDA device (set to empty string for CPU-only)
      - CUDA_VISIBLE_DEVICES=0
      
      # Optional: set additional environment variables
      - PYTHONPATH=/workspace
    
    # Default command - can be overridden
    command: ["micromamba", "run", "-n", "live", "python", "main_coarse.py", "--data_path=/data"]
    
    # Uncomment for interactive mode
    # stdin_open: true
    # tty: true
    
    # Uncomment for GPU support (requires nvidia-docker)
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

  # Optional: development service for interactive work
  supersvg-dev:
    build:
      context: .
      dockerfile: Dockerfile.mamba
    image: supersvg:latest
    container_name: supersvg-dev
    volumes:
      - /path/to/your/dataset:/data
      - .:/workspace
    environment:
      - CUDA_VISIBLE_DEVICES=0
    entrypoint: ["bash"]
    stdin_open: true
    tty: true
    profiles:
      - dev  # Only start when explicitly requested
